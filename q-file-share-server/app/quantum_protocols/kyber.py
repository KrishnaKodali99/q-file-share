from typing import List

from .parameters import N, Q_K, K_K, ETA_K, DT, DU, DV

from .generators import (
    expand_a_kyber,
    get_random_seed,
    generate_sample_noise_polynomial,
    generate_sample_noise_poly_vector,
)

from .helpers import (
    add_polynomials,
    add_polynomial_vectors,
    # compress_poly_QK,
    # decompress_poly_QK,
    multiply_matrix_poly_vector,
    multiply_poly_vectors,
    subtract_polynomials,
    polynomial_ring_reduction,
    reduce_coefficients_mod_q,
    reduce_poly_vector
)

SEED_LENGTH = 32


class Kyber:
    def generate_key_pair(self):
        seed = get_random_seed(SEED_LENGTH)
        A = expand_a_kyber(seed, K_K, K_K, Q_K)

        # A = [[[1693, 271, 1223, 1100, 1670, 627, 726, 2825, 1984, 1956, 2569, 84, 1289, 3379, 3777, 3710, 2371, 4049, 1689, 2310, 2592, 2142, 3727, 3511, 1210, 1398, 2942, 1505, 993, 855, 2410, 1359, 3184, 2723, 1614, 1143, 2659, 758, 3297, 2716, 2726, 571, 4031, 95, 1665, 3677, 2800, 3485, 775, 3250, 3325, 2910, 3484, 235, 3062, 2374, 2591, 1455, 2205, 2738, 382, 212, 1214, 2114, 4020, 3974, 1139, 1213, 2410, 3024, 3626, 315, 170, 4068, 81, 237, 605, 3125, 1089, 99, 3401, 2220, 297, 3506, 1196, 1679, 2946, 2380, 620, 1431, 826, 1460, 2843, 3934, 494, 1400, 2388, 3076, 96, 2028, 3178, 614, 3856, 1936, 3942, 3531, 1684, 3433, 2208, 2718, 893, 3445, 1893, 2625, 896, 234, 2545, 2531, 3217, 2910, 3586, 386, 270, 267, 3093, 1326, 823, 1885, 2337, 2869, 1955, 2587, 3187, 1650, 2998, 777, 3792, 2802, 3811, 2900, 2276, 1477, 74, 1048, 2753, 538, 123, 926, 3041, 1077, 737, 1118, 1766, 3420, 1191, 1800, 3025, 369, 3018, 441, 981, 3373, 53, 881, 27, 1441, 2307, 3082, 4052, 1063, 2627, 3116, 211, 2017, 1554, 1976, 3715, 3862, 3037, 1063, 3430, 1748, 489, 3717, 36, 3810, 3049, 1229, 2236, 584, 1164, 2770, 123, 2875, 2963, 1797, 2868, 957, 3041, 1579, 2091, 1441, 769, 2594, 797, 2773, 1604, 259, 3399, 2746, 3710, 2501, 1447, 1941, 3730, 4062, 1561, 533, 2960, 3912, 780, 639, 3176, 1124, 2525, 3991, 3665, 2337, 956, 2765, 1041, 431, 2249, 1478, 3201, 3740, 1777, 3562, 2434, 317, 205, 414, 3622, 2095, 2611, 2882, 2388, 3839, 1659, 3109, 1060, 977, 2979, 1685, 830, 1769], [367, 397, 3866, 2852, 2979, 355, 479, 2870, 3863, 3097, 1389, 2108, 3597, 639, 3864, 3303, 1647, 1698, 2227, 1826, 1384, 3933, 609, 1356, 2862, 1450, 2073, 3936, 1061, 531, 3188, 589, 2967, 2414, 3715, 1024, 1558, 1807, 3029, 3312, 2699, 91, 106, 2753, 1041, 3514, 855, 56, 1016, 2833, 2514, 2364, 3818, 3866, 209, 3434, 3332, 1976, 3534, 1852, 2973, 543, 3235, 2947, 2265, 2535, 3705, 771, 218, 709, 3038, 1220, 2367, 222, 1824, 1911, 3967, 3543, 1686, 3398, 3141, 944, 2910, 1449, 1045, 1735, 1042, 205, 3172, 149, 584, 1350, 432, 1483, 2636, 2863, 1643, 3322, 575, 1784, 1975, 1721, 2275, 3930, 3608, 2258, 3480, 3742, 2617, 210, 1477, 1835, 2357, 1085, 3788, 1325, 1181, 423, 2910, 705, 1232, 3719, 2921, 289, 1132, 1845, 86, 625, 2833, 776, 2565, 3782, 450, 137, 1592, 1572, 3098, 2976, 2484, 3136, 966, 3957, 3818, 1279, 2618, 1279, 3073, 3526, 4013, 583, 869, 2892, 3558, 1476, 1990, 2939, 2854, 159, 1547, 798, 789, 1610, 2100, 2021, 2510, 1064, 3119, 3933, 828, 695, 2945, 2733, 1113, 2781, 3511, 1503, 944, 341, 3477, 2496, 809, 2377, 1486, 1830, 2088, 2305, 2020, 257, 2876, 1290, 333, 2718, 2171, 691, 1096, 3853, 1512, 623, 3127, 3587, 3100, 3569, 2292, 3322, 3291, 1082, 1938, 1568, 3191, 80, 2515, 2624, 418, 796, 2476, 3302, 2006, 1199, 2988, 1755, 2246, 30, 3662, 4089, 136, 1317, 2657, 2876, 2477, 150, 2486, 499, 1296, 3194, 2129, 2423, 3245, 3584, 559, 2907, 228, 3575, 3821, 2597, 473, 120, 2075, 3541, 2659, 4047, 2597, 361, 2402, 3496, 718, 2307], [2739, 1960, 3734, 2390, 1473, 2298, 3981, 718, 3377, 1826, 3018, 1778, 3380, 1314, 1263, 73, 2352, 2522, 719, 484, 777, 991, 3639, 535, 1547, 1697, 2331, 1647, 3118, 368, 2115, 3156, 3663, 3103, 874, 580, 2994, 4027, 3194, 2092, 371, 4036, 3294, 233, 267, 778, 3011, 323, 116, 1846, 1680, 496, 2184, 1374, 398, 417, 3746, 1492, 3649, 2453, 937, 2399, 330, 2194, 4065, 3540, 2212, 175, 119, 3600, 1246, 296, 1232, 2035, 1981, 2440, 1208, 2097, 3799, 2420, 1506, 3563, 2290, 3724, 3571, 3004, 2121, 2481, 1709, 536, 1269, 955, 883, 632, 1312, 163, 267, 3387, 3286, 2928, 1935, 288, 3209, 1554, 1036, 2813, 796, 3834, 936, 3063, 1677, 2310, 2616, 4025, 132, 2596, 2837, 91, 2288, 2630, 2048, 61, 3448, 1978, 3154, 1522, 902, 1853, 1229, 2595, 3934, 691, 1197, 166, 2127, 3919, 2011, 1248, 1121, 2990, 2323, 2973, 59, 3173, 2309, 2902, 1439, 3385, 1709, 3596, 1496, 3980, 3585, 641, 3602, 1608, 3942, 68, 2059, 3503, 2668, 2873, 1157, 2535, 797, 2964, 2960, 3161, 2588, 1229, 1959, 2783, 290, 2575, 859, 803, 506, 2248, 2158, 120, 1172, 1653, 790, 2524, 412, 3662, 3560, 1099, 949, 2160, 2637, 2217, 3076, 3467, 2610, 1662, 2298, 3800, 1048, 3042, 1205, 778, 898, 363, 2071, 2947, 3546, 1508, 3907, 2932, 994, 2968, 2251, 1339, 1552, 2392, 1437, 767, 81, 1749, 2127, 3875, 3299, 3849, 730, 1961, 2550, 3224, 1483, 1457, 2435, 1215, 950, 2522, 2097, 969, 548, 2893, 4048, 2651, 1275, 772, 458, 2989, 3405, 2503, 3871, 1114, 186, 1194, 354, 1438, 2178, 2986, 1238, 1709]], [[4009, 2675, 955, 1099, 1770, 3436, 1280, 3276, 1811, 1848, 2587, 2604, 1889, 1465, 775, 2692, 1347, 145, 3650, 3483, 2811, 2101, 2063, 2028, 70, 1744, 799, 851, 1787, 758, 1178, 1318, 2852, 2796, 1038, 3127, 1590, 1937, 1258, 1663, 3266, 690, 772, 2348, 2891, 2860, 1581, 2160, 3154, 1195, 576, 1395, 2141, 410, 3088, 3908, 2696, 565, 3455, 1746, 952, 4056, 902, 2983, 3867, 835, 3567, 46, 3097, 2584, 353, 20, 1932, 1740, 560, 388, 3924, 1405, 2635, 2624, 381, 3612, 2102, 3887, 3611, 1267, 2801, 1628, 1843, 393, 1895, 3819, 1656, 1453, 2425, 1566, 3879, 594, 396, 3327, 1106, 2276, 2541, 684, 1579, 2991, 3845, 661, 3544, 1845, 831, 1155, 2451, 1684, 1658, 2610, 1315, 2767, 3311, 1968, 1384, 2802, 444, 2716, 2744, 3879, 84, 477, 3951, 3333, 260, 3785, 3506, 2834, 2863, 360, 1086, 237, 3075, 111, 3245, 2638, 2144, 1331, 1320, 1616, 2448, 1611, 3289, 1228, 1853, 3751, 3196, 34, 145, 2401, 2839, 2814, 2348, 3242, 3963, 1070, 2442, 599, 809, 1882, 1483, 3437, 211, 2640, 1699, 2612, 894, 2105, 1293, 904, 30, 1390, 2458, 1382, 2262, 47, 3956, 2949, 3195, 150, 3037, 4039, 2910, 2841, 1526, 1503, 1991, 2161, 1778, 2782, 2439, 3960, 2895, 151, 2536, 3509, 1845, 2874, 2398, 2751, 3051, 649, 979, 3919, 1648, 1457, 2605, 1080, 699, 959, 2977, 2965, 2921, 988, 211, 1841, 3902, 868, 2496, 1694, 811, 1535, 3674, 1930, 2771, 988, 2516, 222, 2383, 1627, 760, 632, 269, 2638, 2231, 1244, 225, 4077, 104, 1989, 3175, 3570, 2451, 2207, 3366, 12, 1057, 375, 3832, 3062], [2238, 4037, 1545, 2156, 1092, 3744, 2421, 1332, 3630, 903, 1349, 3558, 1005, 2558, 990, 1465, 2584, 3947, 1810, 398, 928, 1860, 593, 3797, 1244, 2445, 4004, 1631, 2477, 1511, 793, 3932, 194, 3944, 336, 1479, 686, 2439, 62, 520, 3338, 2378, 3248, 2887, 186, 3773, 128, 3213, 4051, 1494, 56, 3842, 1406, 2652, 3841, 1412, 3260, 591, 3382, 420, 4039, 2537, 1788, 2677, 4072, 3353, 3801, 4046, 1627, 3531, 891, 748, 3893, 299, 2632, 3037, 3834, 3633, 3954, 2294, 321, 346, 780, 2824, 589, 462, 4093, 997, 3583, 643, 1317, 2258, 3102, 3678, 430, 3965, 3289, 3765, 1, 2673, 2840, 92, 2949, 2826, 301, 428, 2214, 2008, 1853, 3591, 883, 3933, 4079, 1709, 2364, 3683, 593, 912, 134, 3974, 2230, 804, 74, 2106, 172, 2527, 1012, 3189, 2198, 1278, 1043, 3908, 674, 2695, 1635, 3815, 2545, 1963, 2054, 1583, 2055, 2112, 205, 4075, 168, 1171, 673, 770, 4038, 1923, 673, 3802, 2232, 3396, 1017, 1305, 2751, 821, 3110, 3203, 1838, 3555, 1076, 3143, 825, 685, 3516, 2427, 3109, 2433, 541, 3054, 3649, 3599, 3625, 3201, 1107, 1111, 3556, 2553, 3739, 3827, 414, 1340, 784, 170, 3396, 2031, 1633, 4039, 2841, 2499, 191, 2734, 4064, 2195, 3002, 590, 908, 1866, 384, 111, 4084, 49, 1431, 2603, 918, 1427, 1398, 1112, 559, 1837, 217, 12, 1458, 1493, 3069, 2400, 2789, 1557, 1269, 2886, 964, 958, 658, 1890, 940, 1693, 1992, 1339, 1590, 196, 3849, 3322, 2484, 826, 3018, 1439, 778, 3722, 2688, 535, 1338, 625, 3793, 1347, 2468, 252, 2813, 3277, 855, 3552, 4041, 3974, 1029, 2259], [2865, 326, 695, 578, 3273, 764, 3254, 531, 651, 667, 1115, 3927, 3325, 2592, 3035, 967, 1449, 1027, 445, 3402, 116, 2558, 1608, 2489, 973, 618, 1432, 1846, 482, 2026, 3293, 715, 4038, 3496, 636, 2388, 1679, 1333, 902, 2065, 2700, 129, 2247, 1338, 2250, 2435, 539, 988, 3727, 1213, 3406, 2538, 2360, 191, 979, 1655, 2347, 561, 1236, 3157, 2374, 2646, 605, 3728, 1655, 3640, 2966, 3640, 387, 3610, 1064, 1038, 2871, 2383, 3512, 3430, 1543, 3494, 649, 3773, 3991, 3188, 2956, 1479, 1444, 675, 337, 2025, 2282, 3901, 787, 3670, 569, 1124, 1429, 838, 224, 3824, 1468, 2894, 843, 4026, 3068, 2105, 3231, 4062, 628, 3523, 689, 96, 2530, 156, 1415, 1989, 2334, 1747, 2449, 1587, 246, 1781, 1065, 16, 3437, 300, 1305, 1628, 2741, 185, 122, 2378, 3574, 1173, 632, 134, 3995, 3947, 3959, 2845, 1352, 3385, 3992, 2487, 3481, 908, 2736, 313, 109, 3743, 4026, 424, 1650, 1679, 4040, 846, 2541, 690, 2420, 1786, 2546, 3045, 368, 38, 1669, 3391, 3940, 3457, 2408, 1384, 1926, 3464, 2021, 1705, 1644, 1574, 1883, 3604, 1564, 3255, 1665, 3810, 1413, 1396, 2227, 1382, 3129, 3672, 1834, 4023, 1538, 4005, 525, 3515, 2355, 1794, 2212, 3974, 3704, 3660, 3074, 2048, 1989, 3599, 2897, 1795, 797, 239, 1420, 360, 823, 3835, 1630, 3812, 1940, 2161, 2420, 2384, 3378, 957, 3355, 3517, 2478, 2083, 1830, 2371, 2266, 833, 500, 1016, 365, 2941, 3343, 2402, 3366, 2609, 1910, 3706, 1714, 1311, 987, 1255, 3976, 1671, 1870, 1476, 3400, 2245, 2313, 3811, 1820, 1284, 3660, 3678, 2520, 1813, 573, 421]], [[3481, 2685, 3739, 2856, 235, 2206, 663, 240, 1808, 3730, 22, 1093, 1071, 2072, 948, 3055, 1347, 555, 1615, 3547, 2265, 1373, 1924, 81, 307, 1791, 3952, 2988, 1891, 3135, 3677, 3441, 680, 1172, 3541, 330, 2512, 3259, 3791, 344, 3527, 3739, 787, 2529, 900, 1246, 2735, 3793, 1819, 2514, 2431, 2616, 3351, 3318, 3324, 1186, 3246, 3686, 2543, 2319, 1073, 906, 2561, 1814, 2033, 1641, 658, 1021, 1546, 3669, 1182, 2645, 2363, 3700, 3774, 1070, 331, 1683, 310, 2733, 3828, 3235, 2343, 638, 1008, 3387, 1891, 4076, 3316, 963, 3778, 1508, 3062, 813, 2534, 2007, 1584, 2176, 3860, 2823, 1431, 2964, 3252, 2163, 1841, 403, 904, 3126, 3260, 2192, 3416, 2967, 1099, 2463, 424, 3622, 2428, 601, 1255, 897, 3307, 3287, 1945, 3370, 3017, 775, 889, 3686, 1208, 1491, 210, 4024, 3996, 30, 1407, 2669, 3364, 2767, 3413, 1915, 451, 507, 2033, 3646, 1204, 2462, 1672, 1441, 1315, 1565, 3939, 2363, 2283, 2875, 2170, 3102, 1997, 3807, 1821, 1886, 3429, 3135, 1767, 3131, 1650, 3357, 2159, 568, 3051, 3255, 3933, 750, 2466, 2011, 1974, 999, 1819, 2351, 393, 2077, 1851, 470, 2290, 3759, 3321, 3223, 428, 1200, 140, 1511, 2658, 4028, 283, 3956, 439, 434, 1296, 128, 3119, 3577, 518, 949, 1736, 3912, 2904, 3952, 2963, 3175, 3567, 3629, 2300, 2233, 2292, 3558, 4026, 2448, 3534, 302, 1922, 3397, 1253, 1169, 182, 2225, 3942, 3949, 934, 836, 166, 2212, 4033, 3324, 200, 3377, 3408, 692, 1927, 606, 2935, 609, 1480, 1534, 1393, 125, 1431, 3084, 760, 1967, 1723, 1089, 202, 344, 1383, 1184, 2461, 2838], [4082, 999, 2950, 606, 3246, 967, 1314, 2092, 1343, 3263, 2304, 239, 2190, 3600, 51, 721, 1556, 760, 2959, 2978, 4037, 1568, 224, 2806, 2353, 3189, 1579, 912, 1726, 2030, 1541, 2909, 1878, 94, 1943, 3333, 2183, 214, 3063, 3712, 3099, 3132, 3553, 2678, 1031, 2349, 2523, 826, 2398, 1330, 2246, 3780, 2750, 1768, 1198, 1980, 3621, 2047, 2756, 1758, 1149, 1601, 361, 2108, 1725, 2624, 838, 4080, 3844, 4054, 141, 2800, 3505, 1280, 545, 461, 103, 474, 486, 3830, 3579, 3082, 2252, 3122, 905, 3702, 2752, 3781, 2898, 1048, 1340, 3316, 47, 1993, 3368, 1693, 1757, 640, 1877, 3414, 3377, 1336, 1013, 3797, 3816, 978, 53, 2218, 36, 1733, 1974, 2110, 3737, 2679, 1999, 189, 1860, 1487, 236, 2376, 3178, 398, 2545, 1302, 1758, 281, 1413, 3811, 2684, 2827, 1439, 115, 352, 2594, 1542, 2878, 3072, 733, 1524, 514, 3210, 558, 235, 1163, 1501, 577, 1473, 2232, 3966, 2248, 2768, 639, 2778, 304, 783, 3638, 3005, 146, 497, 2063, 1983, 2655, 3349, 1039, 1307, 1608, 641, 1008, 909, 3412, 712, 3448, 1297, 1563, 460, 1606, 3679, 677, 3905, 728, 1714, 2442, 1552, 4029, 132, 3153, 1943, 3368, 1823, 1037, 2911, 589, 3340, 475, 3836, 1660, 2601, 786, 1795, 1556, 1108, 2056, 3326, 2896, 2423, 2033, 1747, 661, 802, 680, 31, 2306, 968, 2631, 731, 2419, 399, 1187, 2044, 1601, 3873, 687, 912, 2501, 3230, 1732, 2255, 2121, 2060, 127, 2429, 2381, 1514, 1779, 3220, 1040, 2207, 3946, 1220, 1921, 161, 1279, 1775, 812, 2333, 486, 2673, 1943, 665, 1645, 2650, 3623, 413, 2683, 892, 3851], [3285, 1928, 3369, 554, 1336, 1565, 3202, 3790, 3113, 2003, 275, 359, 2839, 3881, 2930, 3079, 260, 999, 1791, 3843, 2387, 2214, 1140, 1327, 2307, 2274, 2873, 2728, 2710, 420, 255, 3983, 2401, 2396, 805, 3007, 3574, 2228, 910, 906, 2151, 2844, 892, 3227, 2104, 3126, 1120, 163, 3440, 4011, 2030, 1463, 345, 928, 1055, 2260, 1453, 2090, 3936, 2983, 830, 74, 3525, 1720, 2300, 3994, 1277, 1186, 839, 901, 2596, 2380, 2663, 1911, 68, 2749, 2813, 3336, 2369, 2247, 2299, 4078, 1774, 86, 2817, 3823, 2537, 711, 2828, 1644, 3298, 2477, 2181, 3422, 3595, 3164, 2010, 704, 2143, 3119, 689, 3898, 362, 1000, 753, 155, 1148, 1351, 808, 1821, 1791, 874, 87, 790, 1369, 2980, 3903, 3065, 1820, 564, 264, 386, 1778, 1928, 3970, 645, 2532, 435, 937, 424, 1245, 883, 3751, 3878, 3884, 50, 1198, 741, 359, 687, 1183, 2916, 3742, 1857, 721, 3338, 1683, 3984, 2073, 1093, 2290, 564, 1490, 3438, 2129, 4058, 1631, 3962, 2123, 392, 3702, 154, 3669, 3027, 215, 1267, 2859, 239, 3364, 2983, 2569, 3461, 2630, 2315, 1319, 1826, 3497, 3039, 1924, 2803, 1916, 566, 418, 1380, 2597, 1778, 666, 3354, 2301, 2720, 2666, 1596, 1199, 3254, 358, 1042, 2699, 3239, 2720, 2353, 725, 3357, 0, 3705, 2071, 927, 248, 2040, 3956, 1806, 214, 3144, 2901, 564, 1517, 999, 2397, 2328, 208, 3478, 2864, 1757, 238, 3190, 3389, 1320, 1773, 1252, 3050, 1751, 3852, 4014, 4053, 2850, 3409, 3158, 1583, 2759, 2788, 2751, 3033, 591, 2101, 3039, 1430, 784, 430, 1638, 2159, 369, 2541, 677, 2554, 1611, 2219, 9]]]
        # t  = [[6906, 7200, 1588, 5461, 3941, 2235, 7479, 4882, 2677, 742, 1806, 354, 568, 3962, 1884, 1650, 5857, 4018, 1276, 918, 427, 1970, 4401, 5231, 5208, 7057, 7293, 4207, 2237, 4952, 7180, 2043, 6016, 1060, 2784, 2940, 1386, 4881, 3580, 2162, 3229, 2248, 6686, 1880, 2178, 26, 336, 1009, 1638, 1481, 7023, 1171, 6295, 865, 7096, 5686, 3144, 4395, 6783, 3338, 1750, 5292, 3316, 6517, 2228, 96, 1684, 445, 3628, 3607, 3590, 5843, 2902, 2194, 4623, 6338, 4128, 7337, 4160, 412, 3422, 5310, 5978, 4384, 478, 1710, 914, 3317, 1201, 4851, 5947, 6049, 2457, 5883, 1521, 317, 241, 596, 2448, 4842, 2788, 1566, 5553, 117, 242, 1892, 535, 58, 4393, 1359, 1323, 1326, 3892, 6861, 565, 942, 7403, 5634, 2121, 3794, 3864, 2009, 2345, 4917, 1938, 6136, 2631, 7480, 4519, 5210, 5958, 76, 7268, 3034, 3359, 4074, 6581, 6698, 4131, 1161, 350, 2119, 2754, 3697, 3463, 6483, 6061, 2809, 39, 6346, 2185, 2826, 6092, 5128, 903, 2198, 5190, 4057, 2893, 2051, 3466, 4746, 7633, 6885, 6750, 2398, 7561, 914, 248, 2966, 1017, 4480, 329, 4801, 6081, 3599, 6865, 1604, 2832, 2176, 5565, 4512, 2419, 950, 3175, 4878, 1528, 929, 3958, 344, 5276, 5257, 4639, 151, 4092, 6823, 5088, 7300, 1537, 2714, 3301, 422, 225, 851, 5429, 5851, 4137, 6381, 7006, 5399, 1128, 3444, 3925, 2669, 4706, 5015, 1724, 2541, 18, 4507, 7308, 1963, 5435, 3319, 3263, 2548, 1817, 803, 1238, 2306, 4947, 2144, 4778, 3758, 5666, 484, 5478, 3177, 3568, 1708, 1483, 3259, 7218, 1396, 4898, 658, 109, 7604, 2, 4609, 2979, 1632, 343, 5979, 3546, 2044], [1036, 2879, 3545, 5784, 3640, 4137, 1435, 139, 3098, 5368, 4252, 4286, 7668, 7653, 2152, 6008, 1099, 1690, 6245, 5495, 7281, 1053, 3651, 6064, 6791, 4381, 6603, 1842, 4137, 7668, 6275, 6010, 3319, 4531, 1943, 287, 7485, 4736, 1816, 3321, 7633, 5938, 4950, 46, 4861, 6665, 2761, 3184, 6656, 4659, 607, 3607, 6503, 3695, 4893, 3850, 2468, 7571, 7465, 436, 4499, 5719, 5684, 2119, 3293, 6259, 4858, 557, 836, 5177, 819, 1754, 3894, 707, 6712, 2486, 1229, 3978, 293, 7281, 2383, 3066, 3213, 3678, 4986, 506, 5089, 4712, 7264, 2705, 5121, 6638, 3887, 6111, 5390, 5004, 6097, 6863, 234, 1670, 7153, 7570, 6404, 7611, 4460, 288, 135, 754, 4561, 5265, 7642, 206, 3010, 2717, 442, 4739, 993, 2204, 1919, 3228, 1676, 4988, 1247, 2998, 5767, 7260, 2927, 2460, 580, 6290, 3909, 3192, 4925, 4757, 1234, 6535, 787, 6244, 438, 257, 909, 4949, 663, 6772, 2456, 944, 3041, 469, 2016, 2600, 1277, 3672, 7159, 5456, 2725, 2468, 1038, 6194, 5163, 5454, 7391, 4354, 1716, 2176, 1683, 5397, 3696, 6079, 7536, 5792, 7303, 6290, 861, 221, 7484, 646, 4052, 3326, 1691, 3953, 2043, 1447, 1589, 2110, 5111, 3218, 7075, 7136, 2631, 145, 2411, 6410, 5895, 2143, 4810, 368, 2748, 112, 4032, 6751, 6642, 5370, 1788, 1563, 7107, 1966, 6278, 2785, 3301, 158, 2675, 3859, 4346, 5543, 4414, 2128, 2449, 2396, 2293, 1051, 970, 3087, 2323, 2406, 4894, 7383, 1607, 5487, 2873, 469, 6673, 6368, 2231, 5249, 547, 7577, 7070, 5435, 5170, 3371, 2244, 4430, 6454, 7406, 3154, 6899, 7237, 4409, 6242, 5637, 7509, 5743, 5461, 1395, 4477, 7282], [1816, 4201, 110, 1264, 3493, 2794, 2076, 6890, 1171, 4187, 6980, 6402, 4945, 4687, 5730, 7504, 656, 3565, 3604, 1351, 4014, 2690, 2455, 2208, 247, 513, 2791, 7549, 3281, 144, 3440, 4319, 2009, 2674, 518, 6895, 2975, 5994, 4412, 5239, 2961, 6846, 1950, 823, 5868, 7606, 1761, 2958, 1358, 2688, 4974, 3367, 1834, 896, 1150, 5717, 5263, 6385, 2883, 3254, 2910, 1350, 7524, 6240, 4449, 2610, 2966, 7097, 6254, 1251, 3017, 7187, 2357, 3020, 4103, 3686, 4999, 3173, 4188, 6362, 1843, 1800, 4198, 13, 5914, 2820, 1908, 3036, 1664, 5896, 4712, 5622, 764, 3967, 4616, 3398, 7192, 5594, 3913, 7253, 2495, 4304, 3624, 4750, 2994, 7352, 6373, 1247, 399, 880, 4686, 2875, 7084, 3299, 3249, 1019, 5123, 4005, 4867, 1522, 5533, 6952, 2260, 1634, 6784, 7096, 4282, 1519, 904, 3401, 6052, 98, 5337, 7250, 430, 5012, 3452, 5530, 2629, 474, 6149, 2430, 5052, 2099, 3248, 293, 6851, 2837, 7569, 3355, 4612, 5896, 6165, 1544, 3514, 4793, 4637, 429, 4372, 3770, 7512, 5392, 6864, 6580, 6200, 3042, 7296, 258, 4452, 3109, 6164, 6493, 72, 2963, 249, 4398, 5908, 7220, 2187, 337, 5317, 4070, 1303, 2468, 765, 5290, 7453, 2280, 6541, 708, 2020, 718, 6682, 738, 4589, 2349, 4915, 2066, 3438, 2034, 6923, 6226, 4975, 1182, 351, 862, 2366, 6203, 2893, 5813, 7604, 5939, 264, 4697, 727, 756, 4912, 2334, 774, 708, 2172, 5030, 6858, 4344, 7458, 2116, 1614, 6578, 1484, 7228, 3341, 3314, 287, 4645, 2712, 7083, 4130, 2913, 118, 630, 1423, 1786, 2577, 568, 6207, 6263, 3626, 2107, 2737, 591, 1128, 3334, 5529, 6983, 265, 7001]]
        # s = [[-2, 0, 0, -1, 1, 2, 1, -1, -1, 2, 1, 1, -1, 1, 1, -2, -1, -1, -1, 1, -2, -1, 0, 0, 0, 1, -1, 0, 1, -1, 1, 0, 0, 2, 1, 0, -1, 1, -1, -1, -2, 0, 3, -1, -4, 1, -2, 1, -2, 2, -2, -1, 1, 1, 1, 0, 1, 2, -3, -1, 1, 0, -1, 0, 0, 0, 0, 1, 1, -2, 1, -1, 1, 0, -1, 2, 0, -1, 0, 1, 1, 2, -1, 1, -1, 0, -1, -2, 0, -2, -2, 1, 0, 1, 0, 2, 1, -2, 0, -1, 0, -1, -2, 1, -2, 0, -1, 1, -1, -1, 0, 1, 0, 0, 0, -3, 2, -1, -1, 0, 0, 0, -2, -1, 2, 0, 2, 3, 2, -1, 1, 0, 0, -1, 1, -1, 1, 1, -1, 0, 2, 1, -2, 2, -1, 1, -1, -1, -1, 1, 0, -1, -1, 2, -2, -2, -1, 2, 1, 1, 1, -2, 4, -3, 0, -1, 1, -2, -2, 1, 0, 1, -1, 0, -1, 0, 3, 0, 2, 1, 0, -1, 1, 1, -3, 2, 4, -2, -1, 0, 1, 2, -2, 0, 1, 0, 1, 2, 0, 2, 0, 2, 0, 1, -1, 2, -1, 0, 0, 0, 1, -1, 1, 1, 1, 1, 1, 2, 2, -1, -2, 1, 0, 0, 0, -2, 0, 0, 2, 1, -1, -2, 0, 0, -2, 0, 0, -1, -1, -1, 0, -2, 1, 0, 0, -3, 0, 2, -1, 1, -2, 0, 1, 0, -2, 0], [-1, 1, 1, 1, 0, 0, -1, -2, -1, -1, 0, 0, 1, 0, 1, 0, 0, 3, 0, -1, -1, -1, 0, -1, 3, 1, -1, 0, -1, 2, 2, 0, -1, -1, -1, 0, 2, -1, -1, -1, 0, -1, 0, 0, 0, 0, 0, 0, -1, 0, -1, 1, 0, 1, 0, -2, -2, 1, -2, 2, -2, 0, 1, 0, 0, 1, 0, 0, 0, 0, 2, -1, 1, -2, 0, 1, 0, 1, 2, 1, -3, -3, -1, -1, 2, 0, 2, -3, 1, -1, -1, 2, 0, -1, -1, 0, -2, 0, 1, 3, 2, -2, -2, 0, 0, 1, 1, 1, -2, 0, -3, 1, 1, -1, 2, 0, 2, -1, -1, 0, 2, -1, -1, 1, 2, 0, 2, 1, -1, -2, 0, -1, 1, 0, 0, 0, 0, 0, -1, -2, -1, -1, 2, 3, -3, 0, 1, -3, 1, 1, 2, -3, 1, 0, -2, -2, 0, 3, 0, -2, 0, 1, -1, 0, 0, -2, 0, -1, -1, -1, -3, 1, 1, -1, -2, 0, -1, -2, 0, -1, -2, 1, 0, 4, -2, 1, -1, -2, 1, -1, 0, 1, 1, 1, -2, 2, -1, 0, 0, -2, -1, -1, 0, 1, 2, 0, -2, 0, 0, -1, 0, -2, 1, 0, 0, -1, 3, -2, 1, 0, -1, 0, 2, -2, -1, 3, 2, 1, -1, 0, -2, -1, 0, 0, 0, 0, 0, 0, 2, 1, 2, 0, 0, 2, 1, 2, -1, 1, 0, 0, 1, 1, 0, 0, -1, 2], [0, 0, -2, -1, -2, 1, 0, 0, 1, 2, -2, 1, 0, -1, -1, 1, 1, 0, 2, -2, 2, 2, -1, 1, -3, -1, 3, 2, -1, 2, -3, -2, 0, 2, 2, -2, -1, 1, -1, 3, -1, -2, 0, 1, 0, 1, 1, -1, 3, 0, 0, -1, -1, 0, 1, 1, 1, 2, 1, 1, -1, 0, -3, -2, -2, 1, 0, 0, 2, 1, -2, -1, 2, -1, 0, -1, 2, 3, 1, 2, -1, -1, 2, 2, 0, 1, -1, 3, 0, 0, 1, 0, -1, 1, -1, 0, -2, -2, 1, -2, -2, 0, -2, -2, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, -2, -1, -2, 0, -2, 0, 0, 0, 0, 0, 3, 1, -1, 1, 1, -1, -1, -2, -1, -1, 2, -1, -1, 2, -1, 2, 3, 0, 1, 1, -2, 0, 0, 0, 2, 1, 0, 1, -2, -2, -2, 2, -1, 2, 1, -1, -2, 1, 0, 0, 1, 1, 1, -1, 1, 2, -4, -1, -1, 0, 0, 0, 1, 2, 0, -3, 0, 0, -1, 1, 0, 1, 0, 0, 2, -1, 0, 1, 1, 1, 2, 0, -3, 1, -1, -1, -1, 0, 0, 3, 0, 0, 1, 0, 0, -1, 1, -1, 1, 1, 4, -2, 2, 0, -2, 2, 1, 0, 0, -2, 1, 0, 0, 0, 1, -1, 2, 1, 1, 1, 0, -2, -1, 2, 1, 2, 1, -1, 0, -3, -1, 2, -1, 2, 1, 0, 0, 1, 3, 3, 0, -2]]
        
        s = generate_sample_noise_poly_vector(K_K, ETA_K)
        e = generate_sample_noise_poly_vector(K_K, ETA_K)

        t = add_polynomial_vectors(multiply_matrix_poly_vector(A, s, Q_K), e)
        t = [reduce_coefficients_mod_q(polynomial, Q_K) for polynomial in t]        
                
        return {"public_key": {"t": t, "seed": seed, "A": A}, "secret_key": s}
    
    def encapsulate(self, t: List[List[int]], seed: bytes):
        m = [0, 3841, 0, 0, 3841, 3841, 3841, 3841, 3841, 3841, 3841, 0, 0, 0, 3841, 3841, 0, 0, 0, 0, 0, 0, 3841, 0, 3841, 3841, 3841, 3841, 0, 0, 0, 0, 3841, 0, 0, 0, 3841, 3841, 0, 3841, 0, 0, 0, 3841, 3841, 0, 3841, 0, 0, 3841, 3841, 3841, 0, 0, 0, 0, 3841, 0, 3841, 0, 0, 0, 0, 0, 3841, 0, 0, 3841, 3841, 3841, 0, 0, 0, 3841, 0, 3841, 3841, 3841, 0, 3841, 0, 0, 3841, 0, 0, 3841, 3841, 3841, 3841, 3841, 3841, 0, 3841, 0, 3841, 3841, 3841, 0, 3841, 3841, 3841, 0, 3841, 0, 0, 3841, 3841, 3841, 3841, 0, 3841, 0, 0, 3841, 3841, 0, 3841, 0, 0, 3841, 3841, 3841, 3841, 3841, 0, 3841, 3841, 3841, 0, 3841, 0, 0, 3841, 0, 0, 0, 0, 0, 0, 3841, 3841, 3841, 3841, 0, 3841, 0, 3841, 0, 0, 0, 0, 0, 0, 0, 3841, 3841, 0, 3841, 3841, 0, 0, 0, 0, 0, 3841, 0, 0, 0, 0, 3841, 3841, 0, 3841, 0, 0, 3841, 0, 3841, 0, 3841, 0, 3841, 3841, 3841, 3841, 3841, 0, 3841, 3841, 0, 0, 3841, 3841, 0, 3841, 0, 0, 3841, 3841, 3841, 3841, 0, 0, 3841, 3841, 3841, 0, 3841, 3841, 0, 3841, 0, 0, 0, 3841, 0, 3841, 3841, 3841, 3841, 3841, 3841, 0, 3841, 3841, 3841, 3841, 3841, 0, 0, 3841, 0, 3841, 3841, 3841, 3841, 3841, 3841, 3841, 0, 0, 3841, 3841, 3841, 0, 3841, 3841, 0, 3841, 3841, 3841, 0, 0, 0, 3841, 0]
        A = expand_a_kyber(seed, K_K, K_K, Q_K)
        # A = [[[1693, 271, 1223, 1100, 1670, 627, 726, 2825, 1984, 1956, 2569, 84, 1289, 3379, 3777, 3710, 2371, 4049, 1689, 2310, 2592, 2142, 3727, 3511, 1210, 1398, 2942, 1505, 993, 855, 2410, 1359, 3184, 2723, 1614, 1143, 2659, 758, 3297, 2716, 2726, 571, 4031, 95, 1665, 3677, 2800, 3485, 775, 3250, 3325, 2910, 3484, 235, 3062, 2374, 2591, 1455, 2205, 2738, 382, 212, 1214, 2114, 4020, 3974, 1139, 1213, 2410, 3024, 3626, 315, 170, 4068, 81, 237, 605, 3125, 1089, 99, 3401, 2220, 297, 3506, 1196, 1679, 2946, 2380, 620, 1431, 826, 1460, 2843, 3934, 494, 1400, 2388, 3076, 96, 2028, 3178, 614, 3856, 1936, 3942, 3531, 1684, 3433, 2208, 2718, 893, 3445, 1893, 2625, 896, 234, 2545, 2531, 3217, 2910, 3586, 386, 270, 267, 3093, 1326, 823, 1885, 2337, 2869, 1955, 2587, 3187, 1650, 2998, 777, 3792, 2802, 3811, 2900, 2276, 1477, 74, 1048, 2753, 538, 123, 926, 3041, 1077, 737, 1118, 1766, 3420, 1191, 1800, 3025, 369, 3018, 441, 981, 3373, 53, 881, 27, 1441, 2307, 3082, 4052, 1063, 2627, 3116, 211, 2017, 1554, 1976, 3715, 3862, 3037, 1063, 3430, 1748, 489, 3717, 36, 3810, 3049, 1229, 2236, 584, 1164, 2770, 123, 2875, 2963, 1797, 2868, 957, 3041, 1579, 2091, 1441, 769, 2594, 797, 2773, 1604, 259, 3399, 2746, 3710, 2501, 1447, 1941, 3730, 4062, 1561, 533, 2960, 3912, 780, 639, 3176, 1124, 2525, 3991, 3665, 2337, 956, 2765, 1041, 431, 2249, 1478, 3201, 3740, 1777, 3562, 2434, 317, 205, 414, 3622, 2095, 2611, 2882, 2388, 3839, 1659, 3109, 1060, 977, 2979, 1685, 830, 1769], [367, 397, 3866, 2852, 2979, 355, 479, 2870, 3863, 3097, 1389, 2108, 3597, 639, 3864, 3303, 1647, 1698, 2227, 1826, 1384, 3933, 609, 1356, 2862, 1450, 2073, 3936, 1061, 531, 3188, 589, 2967, 2414, 3715, 1024, 1558, 1807, 3029, 3312, 2699, 91, 106, 2753, 1041, 3514, 855, 56, 1016, 2833, 2514, 2364, 3818, 3866, 209, 3434, 3332, 1976, 3534, 1852, 2973, 543, 3235, 2947, 2265, 2535, 3705, 771, 218, 709, 3038, 1220, 2367, 222, 1824, 1911, 3967, 3543, 1686, 3398, 3141, 944, 2910, 1449, 1045, 1735, 1042, 205, 3172, 149, 584, 1350, 432, 1483, 2636, 2863, 1643, 3322, 575, 1784, 1975, 1721, 2275, 3930, 3608, 2258, 3480, 3742, 2617, 210, 1477, 1835, 2357, 1085, 3788, 1325, 1181, 423, 2910, 705, 1232, 3719, 2921, 289, 1132, 1845, 86, 625, 2833, 776, 2565, 3782, 450, 137, 1592, 1572, 3098, 2976, 2484, 3136, 966, 3957, 3818, 1279, 2618, 1279, 3073, 3526, 4013, 583, 869, 2892, 3558, 1476, 1990, 2939, 2854, 159, 1547, 798, 789, 1610, 2100, 2021, 2510, 1064, 3119, 3933, 828, 695, 2945, 2733, 1113, 2781, 3511, 1503, 944, 341, 3477, 2496, 809, 2377, 1486, 1830, 2088, 2305, 2020, 257, 2876, 1290, 333, 2718, 2171, 691, 1096, 3853, 1512, 623, 3127, 3587, 3100, 3569, 2292, 3322, 3291, 1082, 1938, 1568, 3191, 80, 2515, 2624, 418, 796, 2476, 3302, 2006, 1199, 2988, 1755, 2246, 30, 3662, 4089, 136, 1317, 2657, 2876, 2477, 150, 2486, 499, 1296, 3194, 2129, 2423, 3245, 3584, 559, 2907, 228, 3575, 3821, 2597, 473, 120, 2075, 3541, 2659, 4047, 2597, 361, 2402, 3496, 718, 2307], [2739, 1960, 3734, 2390, 1473, 2298, 3981, 718, 3377, 1826, 3018, 1778, 3380, 1314, 1263, 73, 2352, 2522, 719, 484, 777, 991, 3639, 535, 1547, 1697, 2331, 1647, 3118, 368, 2115, 3156, 3663, 3103, 874, 580, 2994, 4027, 3194, 2092, 371, 4036, 3294, 233, 267, 778, 3011, 323, 116, 1846, 1680, 496, 2184, 1374, 398, 417, 3746, 1492, 3649, 2453, 937, 2399, 330, 2194, 4065, 3540, 2212, 175, 119, 3600, 1246, 296, 1232, 2035, 1981, 2440, 1208, 2097, 3799, 2420, 1506, 3563, 2290, 3724, 3571, 3004, 2121, 2481, 1709, 536, 1269, 955, 883, 632, 1312, 163, 267, 3387, 3286, 2928, 1935, 288, 3209, 1554, 1036, 2813, 796, 3834, 936, 3063, 1677, 2310, 2616, 4025, 132, 2596, 2837, 91, 2288, 2630, 2048, 61, 3448, 1978, 3154, 1522, 902, 1853, 1229, 2595, 3934, 691, 1197, 166, 2127, 3919, 2011, 1248, 1121, 2990, 2323, 2973, 59, 3173, 2309, 2902, 1439, 3385, 1709, 3596, 1496, 3980, 3585, 641, 3602, 1608, 3942, 68, 2059, 3503, 2668, 2873, 1157, 2535, 797, 2964, 2960, 3161, 2588, 1229, 1959, 2783, 290, 2575, 859, 803, 506, 2248, 2158, 120, 1172, 1653, 790, 2524, 412, 3662, 3560, 1099, 949, 2160, 2637, 2217, 3076, 3467, 2610, 1662, 2298, 3800, 1048, 3042, 1205, 778, 898, 363, 2071, 2947, 3546, 1508, 3907, 2932, 994, 2968, 2251, 1339, 1552, 2392, 1437, 767, 81, 1749, 2127, 3875, 3299, 3849, 730, 1961, 2550, 3224, 1483, 1457, 2435, 1215, 950, 2522, 2097, 969, 548, 2893, 4048, 2651, 1275, 772, 458, 2989, 3405, 2503, 3871, 1114, 186, 1194, 354, 1438, 2178, 2986, 1238, 1709]], [[4009, 2675, 955, 1099, 1770, 3436, 1280, 3276, 1811, 1848, 2587, 2604, 1889, 1465, 775, 2692, 1347, 145, 3650, 3483, 2811, 2101, 2063, 2028, 70, 1744, 799, 851, 1787, 758, 1178, 1318, 2852, 2796, 1038, 3127, 1590, 1937, 1258, 1663, 3266, 690, 772, 2348, 2891, 2860, 1581, 2160, 3154, 1195, 576, 1395, 2141, 410, 3088, 3908, 2696, 565, 3455, 1746, 952, 4056, 902, 2983, 3867, 835, 3567, 46, 3097, 2584, 353, 20, 1932, 1740, 560, 388, 3924, 1405, 2635, 2624, 381, 3612, 2102, 3887, 3611, 1267, 2801, 1628, 1843, 393, 1895, 3819, 1656, 1453, 2425, 1566, 3879, 594, 396, 3327, 1106, 2276, 2541, 684, 1579, 2991, 3845, 661, 3544, 1845, 831, 1155, 2451, 1684, 1658, 2610, 1315, 2767, 3311, 1968, 1384, 2802, 444, 2716, 2744, 3879, 84, 477, 3951, 3333, 260, 3785, 3506, 2834, 2863, 360, 1086, 237, 3075, 111, 3245, 2638, 2144, 1331, 1320, 1616, 2448, 1611, 3289, 1228, 1853, 3751, 3196, 34, 145, 2401, 2839, 2814, 2348, 3242, 3963, 1070, 2442, 599, 809, 1882, 1483, 3437, 211, 2640, 1699, 2612, 894, 2105, 1293, 904, 30, 1390, 2458, 1382, 2262, 47, 3956, 2949, 3195, 150, 3037, 4039, 2910, 2841, 1526, 1503, 1991, 2161, 1778, 2782, 2439, 3960, 2895, 151, 2536, 3509, 1845, 2874, 2398, 2751, 3051, 649, 979, 3919, 1648, 1457, 2605, 1080, 699, 959, 2977, 2965, 2921, 988, 211, 1841, 3902, 868, 2496, 1694, 811, 1535, 3674, 1930, 2771, 988, 2516, 222, 2383, 1627, 760, 632, 269, 2638, 2231, 1244, 225, 4077, 104, 1989, 3175, 3570, 2451, 2207, 3366, 12, 1057, 375, 3832, 3062], [2238, 4037, 1545, 2156, 1092, 3744, 2421, 1332, 3630, 903, 1349, 3558, 1005, 2558, 990, 1465, 2584, 3947, 1810, 398, 928, 1860, 593, 3797, 1244, 2445, 4004, 1631, 2477, 1511, 793, 3932, 194, 3944, 336, 1479, 686, 2439, 62, 520, 3338, 2378, 3248, 2887, 186, 3773, 128, 3213, 4051, 1494, 56, 3842, 1406, 2652, 3841, 1412, 3260, 591, 3382, 420, 4039, 2537, 1788, 2677, 4072, 3353, 3801, 4046, 1627, 3531, 891, 748, 3893, 299, 2632, 3037, 3834, 3633, 3954, 2294, 321, 346, 780, 2824, 589, 462, 4093, 997, 3583, 643, 1317, 2258, 3102, 3678, 430, 3965, 3289, 3765, 1, 2673, 2840, 92, 2949, 2826, 301, 428, 2214, 2008, 1853, 3591, 883, 3933, 4079, 1709, 2364, 3683, 593, 912, 134, 3974, 2230, 804, 74, 2106, 172, 2527, 1012, 3189, 2198, 1278, 1043, 3908, 674, 2695, 1635, 3815, 2545, 1963, 2054, 1583, 2055, 2112, 205, 4075, 168, 1171, 673, 770, 4038, 1923, 673, 3802, 2232, 3396, 1017, 1305, 2751, 821, 3110, 3203, 1838, 3555, 1076, 3143, 825, 685, 3516, 2427, 3109, 2433, 541, 3054, 3649, 3599, 3625, 3201, 1107, 1111, 3556, 2553, 3739, 3827, 414, 1340, 784, 170, 3396, 2031, 1633, 4039, 2841, 2499, 191, 2734, 4064, 2195, 3002, 590, 908, 1866, 384, 111, 4084, 49, 1431, 2603, 918, 1427, 1398, 1112, 559, 1837, 217, 12, 1458, 1493, 3069, 2400, 2789, 1557, 1269, 2886, 964, 958, 658, 1890, 940, 1693, 1992, 1339, 1590, 196, 3849, 3322, 2484, 826, 3018, 1439, 778, 3722, 2688, 535, 1338, 625, 3793, 1347, 2468, 252, 2813, 3277, 855, 3552, 4041, 3974, 1029, 2259], [2865, 326, 695, 578, 3273, 764, 3254, 531, 651, 667, 1115, 3927, 3325, 2592, 3035, 967, 1449, 1027, 445, 3402, 116, 2558, 1608, 2489, 973, 618, 1432, 1846, 482, 2026, 3293, 715, 4038, 3496, 636, 2388, 1679, 1333, 902, 2065, 2700, 129, 2247, 1338, 2250, 2435, 539, 988, 3727, 1213, 3406, 2538, 2360, 191, 979, 1655, 2347, 561, 1236, 3157, 2374, 2646, 605, 3728, 1655, 3640, 2966, 3640, 387, 3610, 1064, 1038, 2871, 2383, 3512, 3430, 1543, 3494, 649, 3773, 3991, 3188, 2956, 1479, 1444, 675, 337, 2025, 2282, 3901, 787, 3670, 569, 1124, 1429, 838, 224, 3824, 1468, 2894, 843, 4026, 3068, 2105, 3231, 4062, 628, 3523, 689, 96, 2530, 156, 1415, 1989, 2334, 1747, 2449, 1587, 246, 1781, 1065, 16, 3437, 300, 1305, 1628, 2741, 185, 122, 2378, 3574, 1173, 632, 134, 3995, 3947, 3959, 2845, 1352, 3385, 3992, 2487, 3481, 908, 2736, 313, 109, 3743, 4026, 424, 1650, 1679, 4040, 846, 2541, 690, 2420, 1786, 2546, 3045, 368, 38, 1669, 3391, 3940, 3457, 2408, 1384, 1926, 3464, 2021, 1705, 1644, 1574, 1883, 3604, 1564, 3255, 1665, 3810, 1413, 1396, 2227, 1382, 3129, 3672, 1834, 4023, 1538, 4005, 525, 3515, 2355, 1794, 2212, 3974, 3704, 3660, 3074, 2048, 1989, 3599, 2897, 1795, 797, 239, 1420, 360, 823, 3835, 1630, 3812, 1940, 2161, 2420, 2384, 3378, 957, 3355, 3517, 2478, 2083, 1830, 2371, 2266, 833, 500, 1016, 365, 2941, 3343, 2402, 3366, 2609, 1910, 3706, 1714, 1311, 987, 1255, 3976, 1671, 1870, 1476, 3400, 2245, 2313, 3811, 1820, 1284, 3660, 3678, 2520, 1813, 573, 421]], [[3481, 2685, 3739, 2856, 235, 2206, 663, 240, 1808, 3730, 22, 1093, 1071, 2072, 948, 3055, 1347, 555, 1615, 3547, 2265, 1373, 1924, 81, 307, 1791, 3952, 2988, 1891, 3135, 3677, 3441, 680, 1172, 3541, 330, 2512, 3259, 3791, 344, 3527, 3739, 787, 2529, 900, 1246, 2735, 3793, 1819, 2514, 2431, 2616, 3351, 3318, 3324, 1186, 3246, 3686, 2543, 2319, 1073, 906, 2561, 1814, 2033, 1641, 658, 1021, 1546, 3669, 1182, 2645, 2363, 3700, 3774, 1070, 331, 1683, 310, 2733, 3828, 3235, 2343, 638, 1008, 3387, 1891, 4076, 3316, 963, 3778, 1508, 3062, 813, 2534, 2007, 1584, 2176, 3860, 2823, 1431, 2964, 3252, 2163, 1841, 403, 904, 3126, 3260, 2192, 3416, 2967, 1099, 2463, 424, 3622, 2428, 601, 1255, 897, 3307, 3287, 1945, 3370, 3017, 775, 889, 3686, 1208, 1491, 210, 4024, 3996, 30, 1407, 2669, 3364, 2767, 3413, 1915, 451, 507, 2033, 3646, 1204, 2462, 1672, 1441, 1315, 1565, 3939, 2363, 2283, 2875, 2170, 3102, 1997, 3807, 1821, 1886, 3429, 3135, 1767, 3131, 1650, 3357, 2159, 568, 3051, 3255, 3933, 750, 2466, 2011, 1974, 999, 1819, 2351, 393, 2077, 1851, 470, 2290, 3759, 3321, 3223, 428, 1200, 140, 1511, 2658, 4028, 283, 3956, 439, 434, 1296, 128, 3119, 3577, 518, 949, 1736, 3912, 2904, 3952, 2963, 3175, 3567, 3629, 2300, 2233, 2292, 3558, 4026, 2448, 3534, 302, 1922, 3397, 1253, 1169, 182, 2225, 3942, 3949, 934, 836, 166, 2212, 4033, 3324, 200, 3377, 3408, 692, 1927, 606, 2935, 609, 1480, 1534, 1393, 125, 1431, 3084, 760, 1967, 1723, 1089, 202, 344, 1383, 1184, 2461, 2838], [4082, 999, 2950, 606, 3246, 967, 1314, 2092, 1343, 3263, 2304, 239, 2190, 3600, 51, 721, 1556, 760, 2959, 2978, 4037, 1568, 224, 2806, 2353, 3189, 1579, 912, 1726, 2030, 1541, 2909, 1878, 94, 1943, 3333, 2183, 214, 3063, 3712, 3099, 3132, 3553, 2678, 1031, 2349, 2523, 826, 2398, 1330, 2246, 3780, 2750, 1768, 1198, 1980, 3621, 2047, 2756, 1758, 1149, 1601, 361, 2108, 1725, 2624, 838, 4080, 3844, 4054, 141, 2800, 3505, 1280, 545, 461, 103, 474, 486, 3830, 3579, 3082, 2252, 3122, 905, 3702, 2752, 3781, 2898, 1048, 1340, 3316, 47, 1993, 3368, 1693, 1757, 640, 1877, 3414, 3377, 1336, 1013, 3797, 3816, 978, 53, 2218, 36, 1733, 1974, 2110, 3737, 2679, 1999, 189, 1860, 1487, 236, 2376, 3178, 398, 2545, 1302, 1758, 281, 1413, 3811, 2684, 2827, 1439, 115, 352, 2594, 1542, 2878, 3072, 733, 1524, 514, 3210, 558, 235, 1163, 1501, 577, 1473, 2232, 3966, 2248, 2768, 639, 2778, 304, 783, 3638, 3005, 146, 497, 2063, 1983, 2655, 3349, 1039, 1307, 1608, 641, 1008, 909, 3412, 712, 3448, 1297, 1563, 460, 1606, 3679, 677, 3905, 728, 1714, 2442, 1552, 4029, 132, 3153, 1943, 3368, 1823, 1037, 2911, 589, 3340, 475, 3836, 1660, 2601, 786, 1795, 1556, 1108, 2056, 3326, 2896, 2423, 2033, 1747, 661, 802, 680, 31, 2306, 968, 2631, 731, 2419, 399, 1187, 2044, 1601, 3873, 687, 912, 2501, 3230, 1732, 2255, 2121, 2060, 127, 2429, 2381, 1514, 1779, 3220, 1040, 2207, 3946, 1220, 1921, 161, 1279, 1775, 812, 2333, 486, 2673, 1943, 665, 1645, 2650, 3623, 413, 2683, 892, 3851], [3285, 1928, 3369, 554, 1336, 1565, 3202, 3790, 3113, 2003, 275, 359, 2839, 3881, 2930, 3079, 260, 999, 1791, 3843, 2387, 2214, 1140, 1327, 2307, 2274, 2873, 2728, 2710, 420, 255, 3983, 2401, 2396, 805, 3007, 3574, 2228, 910, 906, 2151, 2844, 892, 3227, 2104, 3126, 1120, 163, 3440, 4011, 2030, 1463, 345, 928, 1055, 2260, 1453, 2090, 3936, 2983, 830, 74, 3525, 1720, 2300, 3994, 1277, 1186, 839, 901, 2596, 2380, 2663, 1911, 68, 2749, 2813, 3336, 2369, 2247, 2299, 4078, 1774, 86, 2817, 3823, 2537, 711, 2828, 1644, 3298, 2477, 2181, 3422, 3595, 3164, 2010, 704, 2143, 3119, 689, 3898, 362, 1000, 753, 155, 1148, 1351, 808, 1821, 1791, 874, 87, 790, 1369, 2980, 3903, 3065, 1820, 564, 264, 386, 1778, 1928, 3970, 645, 2532, 435, 937, 424, 1245, 883, 3751, 3878, 3884, 50, 1198, 741, 359, 687, 1183, 2916, 3742, 1857, 721, 3338, 1683, 3984, 2073, 1093, 2290, 564, 1490, 3438, 2129, 4058, 1631, 3962, 2123, 392, 3702, 154, 3669, 3027, 215, 1267, 2859, 239, 3364, 2983, 2569, 3461, 2630, 2315, 1319, 1826, 3497, 3039, 1924, 2803, 1916, 566, 418, 1380, 2597, 1778, 666, 3354, 2301, 2720, 2666, 1596, 1199, 3254, 358, 1042, 2699, 3239, 2720, 2353, 725, 3357, 0, 3705, 2071, 927, 248, 2040, 3956, 1806, 214, 3144, 2901, 564, 1517, 999, 2397, 2328, 208, 3478, 2864, 1757, 238, 3190, 3389, 1320, 1773, 1252, 3050, 1751, 3852, 4014, 4053, 2850, 3409, 3158, 1583, 2759, 2788, 2751, 3033, 591, 2101, 3039, 1430, 784, 430, 1638, 2159, 369, 2541, 677, 2554, 1611, 2219, 9]]]
        # t  = [[6906, 7200, 1588, 5461, 3941, 2235, 7479, 4882, 2677, 742, 1806, 354, 568, 3962, 1884, 1650, 5857, 4018, 1276, 918, 427, 1970, 4401, 5231, 5208, 7057, 7293, 4207, 2237, 4952, 7180, 2043, 6016, 1060, 2784, 2940, 1386, 4881, 3580, 2162, 3229, 2248, 6686, 1880, 2178, 26, 336, 1009, 1638, 1481, 7023, 1171, 6295, 865, 7096, 5686, 3144, 4395, 6783, 3338, 1750, 5292, 3316, 6517, 2228, 96, 1684, 445, 3628, 3607, 3590, 5843, 2902, 2194, 4623, 6338, 4128, 7337, 4160, 412, 3422, 5310, 5978, 4384, 478, 1710, 914, 3317, 1201, 4851, 5947, 6049, 2457, 5883, 1521, 317, 241, 596, 2448, 4842, 2788, 1566, 5553, 117, 242, 1892, 535, 58, 4393, 1359, 1323, 1326, 3892, 6861, 565, 942, 7403, 5634, 2121, 3794, 3864, 2009, 2345, 4917, 1938, 6136, 2631, 7480, 4519, 5210, 5958, 76, 7268, 3034, 3359, 4074, 6581, 6698, 4131, 1161, 350, 2119, 2754, 3697, 3463, 6483, 6061, 2809, 39, 6346, 2185, 2826, 6092, 5128, 903, 2198, 5190, 4057, 2893, 2051, 3466, 4746, 7633, 6885, 6750, 2398, 7561, 914, 248, 2966, 1017, 4480, 329, 4801, 6081, 3599, 6865, 1604, 2832, 2176, 5565, 4512, 2419, 950, 3175, 4878, 1528, 929, 3958, 344, 5276, 5257, 4639, 151, 4092, 6823, 5088, 7300, 1537, 2714, 3301, 422, 225, 851, 5429, 5851, 4137, 6381, 7006, 5399, 1128, 3444, 3925, 2669, 4706, 5015, 1724, 2541, 18, 4507, 7308, 1963, 5435, 3319, 3263, 2548, 1817, 803, 1238, 2306, 4947, 2144, 4778, 3758, 5666, 484, 5478, 3177, 3568, 1708, 1483, 3259, 7218, 1396, 4898, 658, 109, 7604, 2, 4609, 2979, 1632, 343, 5979, 3546, 2044], [1036, 2879, 3545, 5784, 3640, 4137, 1435, 139, 3098, 5368, 4252, 4286, 7668, 7653, 2152, 6008, 1099, 1690, 6245, 5495, 7281, 1053, 3651, 6064, 6791, 4381, 6603, 1842, 4137, 7668, 6275, 6010, 3319, 4531, 1943, 287, 7485, 4736, 1816, 3321, 7633, 5938, 4950, 46, 4861, 6665, 2761, 3184, 6656, 4659, 607, 3607, 6503, 3695, 4893, 3850, 2468, 7571, 7465, 436, 4499, 5719, 5684, 2119, 3293, 6259, 4858, 557, 836, 5177, 819, 1754, 3894, 707, 6712, 2486, 1229, 3978, 293, 7281, 2383, 3066, 3213, 3678, 4986, 506, 5089, 4712, 7264, 2705, 5121, 6638, 3887, 6111, 5390, 5004, 6097, 6863, 234, 1670, 7153, 7570, 6404, 7611, 4460, 288, 135, 754, 4561, 5265, 7642, 206, 3010, 2717, 442, 4739, 993, 2204, 1919, 3228, 1676, 4988, 1247, 2998, 5767, 7260, 2927, 2460, 580, 6290, 3909, 3192, 4925, 4757, 1234, 6535, 787, 6244, 438, 257, 909, 4949, 663, 6772, 2456, 944, 3041, 469, 2016, 2600, 1277, 3672, 7159, 5456, 2725, 2468, 1038, 6194, 5163, 5454, 7391, 4354, 1716, 2176, 1683, 5397, 3696, 6079, 7536, 5792, 7303, 6290, 861, 221, 7484, 646, 4052, 3326, 1691, 3953, 2043, 1447, 1589, 2110, 5111, 3218, 7075, 7136, 2631, 145, 2411, 6410, 5895, 2143, 4810, 368, 2748, 112, 4032, 6751, 6642, 5370, 1788, 1563, 7107, 1966, 6278, 2785, 3301, 158, 2675, 3859, 4346, 5543, 4414, 2128, 2449, 2396, 2293, 1051, 970, 3087, 2323, 2406, 4894, 7383, 1607, 5487, 2873, 469, 6673, 6368, 2231, 5249, 547, 7577, 7070, 5435, 5170, 3371, 2244, 4430, 6454, 7406, 3154, 6899, 7237, 4409, 6242, 5637, 7509, 5743, 5461, 1395, 4477, 7282], [1816, 4201, 110, 1264, 3493, 2794, 2076, 6890, 1171, 4187, 6980, 6402, 4945, 4687, 5730, 7504, 656, 3565, 3604, 1351, 4014, 2690, 2455, 2208, 247, 513, 2791, 7549, 3281, 144, 3440, 4319, 2009, 2674, 518, 6895, 2975, 5994, 4412, 5239, 2961, 6846, 1950, 823, 5868, 7606, 1761, 2958, 1358, 2688, 4974, 3367, 1834, 896, 1150, 5717, 5263, 6385, 2883, 3254, 2910, 1350, 7524, 6240, 4449, 2610, 2966, 7097, 6254, 1251, 3017, 7187, 2357, 3020, 4103, 3686, 4999, 3173, 4188, 6362, 1843, 1800, 4198, 13, 5914, 2820, 1908, 3036, 1664, 5896, 4712, 5622, 764, 3967, 4616, 3398, 7192, 5594, 3913, 7253, 2495, 4304, 3624, 4750, 2994, 7352, 6373, 1247, 399, 880, 4686, 2875, 7084, 3299, 3249, 1019, 5123, 4005, 4867, 1522, 5533, 6952, 2260, 1634, 6784, 7096, 4282, 1519, 904, 3401, 6052, 98, 5337, 7250, 430, 5012, 3452, 5530, 2629, 474, 6149, 2430, 5052, 2099, 3248, 293, 6851, 2837, 7569, 3355, 4612, 5896, 6165, 1544, 3514, 4793, 4637, 429, 4372, 3770, 7512, 5392, 6864, 6580, 6200, 3042, 7296, 258, 4452, 3109, 6164, 6493, 72, 2963, 249, 4398, 5908, 7220, 2187, 337, 5317, 4070, 1303, 2468, 765, 5290, 7453, 2280, 6541, 708, 2020, 718, 6682, 738, 4589, 2349, 4915, 2066, 3438, 2034, 6923, 6226, 4975, 1182, 351, 862, 2366, 6203, 2893, 5813, 7604, 5939, 264, 4697, 727, 756, 4912, 2334, 774, 708, 2172, 5030, 6858, 4344, 7458, 2116, 1614, 6578, 1484, 7228, 3341, 3314, 287, 4645, 2712, 7083, 4130, 2913, 118, 630, 1423, 1786, 2577, 568, 6207, 6263, 3626, 2107, 2737, 591, 1128, 3334, 5529, 6983, 265, 7001]]

        r = generate_sample_noise_poly_vector(K_K, ETA_K)
        e1 = generate_sample_noise_poly_vector(K_K, ETA_K)
        e2 = generate_sample_noise_polynomial(ETA_K)
        
        # r = [[1, 2, 1, 0, 2, -1, 0, -1, -2, 2, -3, 0, 0, 3, 1, 1, -1, -2, 1, 0, 1, 0, 0, 2, -1, -2, 0, 1, 2, -1, 4, 2, 1, -1, -3, -1, 2, -1, 2, -1, 1, -1, -1, 2, 1, -1, 1, 0, 2, -1, 0, -1, 1, -1, 2, 0, 0, 1, 2, 0, -3, 1, 0, 1, -3, 1, 0, -1, -1, 1, -2, 1, -1, 3, -1, -3, 1, 1, 2, -1, 2, 0, 0, -2, -1, 2, 1, 0, 1, -2, -1, 0, 0, 1, -2, 0, -2, 2, -1, 0, 0, 1, -1, 0, 0, 0, 1, 1, -3, -1, -2, 0, 1, 0, 0, 1, 0, -1, -2, 0, 2, 0, -4, -1, 0, -1, 1, -1, -1, 1, 1, -2, 0, 0, 0, 2, -1, -2, 0, -1, 0, 0, 2, 0, 1, 2, -2, 2, 1, 0, -1, 0, -2, 2, -1, 2, -1, 0, -1, 0, 1, 0, 0, 1, -2, 1, 0, -2, 0, -2, 1, 0, 0, -2, -1, 1, 0, 2, -1, -2, 0, -1, -2, 1, -1, 1, 0, 1, 0, -1, -2, 2, 1, 1, -1, 1, -2, 0, -1, 1, -2, -1, -2, 1, 0, 3, 1, 0, 0, 2, 1, -1, 1, 3, -1, 1, 3, 1, 0, 0, 0, 0, 1, -2, 0, 0, 0, 1, 0, -2, -1, -2, -1, 0, 2, 0, 3, 0, -2, 2, 1, 0, 1, 2, 0, 0, 2, -1, 1, 2, 2, -1, -1, 0, 1, 1], [3, -1, 0, -2, 1, 2, -2, 1, -3, 2, 2, -3, 1, 0, -3, 1, 2, 0, 0, 1, 0, 0, 2, 0, -1, 3, -1, -2, -1, 1, 1, 0, 0, -2, -1, 0, -1, 1, -2, 0, 0, -1, 0, 1, 0, 2, 1, -1, 1, -1, 1, -2, 1, 0, 1, 0, 0, 1, 0, -1, -1, 0, -1, -3, -1, 1, -2, 2, -2, -1, -3, 1, 2, -2, -2, -1, 0, 1, -1, -4, 0, 0, 4, -3, 0, 4, 0, 2, -2, -1, -1, -3, 1, -1, 0, 0, 0, 0, -2, -1, 2, -1, 1, 0, 1, 0, 2, 0, -1, 2, 2, 0, 0, -1, 0, -1, -2, 2, 2, 0, 1, 2, 0, 0, 0, 2, -1, -1, 1, -1, -1, -2, 0, -1, 1, -1, 1, 3, -1, 0, 0, 0, 0, 1, 2, -1, -1, 1, 0, 0, 1, -1, 1, -2, 1, 1, -1, 0, 0, 2, 0, -1, -2, -2, 2, 1, 0, -2, -2, 0, -2, -3, 0, -1, 1, 0, -1, 0, 0, 0, -1, -3, 1, 1, -1, 0, 1, 0, 3, 0, 0, 0, -2, 1, 0, 2, -2, -2, -2, 0, 1, 0, -2, -2, 1, 0, -1, -1, 1, 0, 2, 1, 1, 1, 0, -1, 0, 0, 0, 1, 0, -1, 0, 2, 1, -2, 1, -1, -1, 1, 0, 2, 0, 0, 0, 2, 2, 2, 1, -1, 0, -2, 2, 0, -1, 1, 2, 0, 0, -2, 1, 2, 2, 1, -1, -1], [-1, -1, -1, 0, 0, 0, 2, 0, 0, 3, -2, -1, 1, 0, 2, 1, 0, 1, -3, 0, 0, -1, -1, 0, 0, 0, -1, -1, -1, 1, 0, 2, -2, -1, 0, 0, 0, -1, 2, 0, -2, 0, 1, -1, -1, -1, 0, 0, 0, 1, 1, 2, 0, 0, -1, 1, 2, 0, -1, 0, 1, 0, 1, 1, -2, 0, -1, -1, -2, -2, 0, 2, 0, -2, -2, 2, 0, 0, 0, 0, 2, 0, -1, 0, 0, -1, 1, 1, 0, -2, 0, -2, 1, 1, 1, 0, -1, 0, 3, -2, -2, -1, 1, 2, -1, 0, 1, -2, 0, 1, -3, 2, -1, -1, 0, -1, 2, -1, 0, 1, 1, 1, -1, 1, 1, 1, 0, 1, 1, -1, 0, -1, -1, 1, 1, -1, 0, -1, -2, -2, -1, -1, 0, -3, -1, 3, 2, 2, -2, 0, 1, 0, 1, -1, 0, 1, 0, 1, 0, -1, 0, 2, -1, -1, -1, -2, 1, 0, -2, -1, 0, -1, -2, -1, 0, 0, 2, 1, -1, 2, -3, 0, 1, -1, 1, -1, 0, 1, 0, 0, 1, 1, 0, 1, 2, 1, 2, -1, -1, 2, -2, 0, -3, 0, 2, 0, 1, 0, 1, 1, 2, -4, -2, -1, 1, 0, 2, 0, 0, -1, -1, 3, 2, 0, 0, 0, 1, -1, 0, -1, 0, -1, 1, -2, -1, 2, 1, -1, 0, 1, 0, -2, 0, 0, 2, 4, 1, -1, 2, 1, -2, 0, 1, 1, -1, -2]]
        # e1 = [[1, 0, -1, 0, -3, 2, -2, 0, -1, 3, -1, 1, -3, -1, 2, 0, 0, -3, 0, 1, -2, 0, 1, -1, 1, 0, -2, -1, 0, 1, -2, 0, -2, 0, 1, -1, 0, -1, -1, 0, -2, -1, -2, 3, 1, -1, -1, 0, 1, -2, 0, 1, -1, 1, 1, -1, -1, 0, 2, -1, 2, 1, 1, 0, 0, -1, 2, 2, 0, 2, -1, 2, -1, -1, -1, 1, 0, -2, -1, 2, 1, -2, -1, -1, -1, 1, 3, 0, -1, 1, 2, -1, 0, 1, 0, -1, -2, -1, 1, -1, 0, -3, 2, -1, -2, -2, 1, 2, -2, -1, -1, -1, -1, -1, 0, 0, -1, 0, -1, 1, 2, 1, 2, 0, 2, 1, 2, 1, 0, -2, 2, 0, -2, 3, 0, 1, 0, -1, -3, -3, -2, -2, -3, 2, -1, 1, 4, -1, -2, 2, -1, -1, 1, 1, 1, 3, 1, 1, 1, 0, 1, -2, -1, 3, 0, -1, 1, -1, -1, 3, 0, 0, 0, -2, 1, -2, -1, 2, 1, -2, -1, 1, 1, -3, -1, 1, 0, 2, 2, 2, -2, 1, -1, 2, -2, 0, 1, 0, -1, 0, -1, 3, 0, -2, -2, -2, 0, 2, -1, -1, 1, -1, 0, 3, 0, 1, 1, -1, 0, -2, 0, -1, 0, 0, -1, 0, 2, -1, 1, 0, -2, -1, 2, 1, 0, 0, 0, -1, 2, -1, -2, -1, 1, -1, 1, -3, 0, 1, 1, 1, 0, -1, -1, 2, 0, 0], [0, 0, 0, 1, 0, 0, -1, 2, 0, 2, 2, -1, 0, 3, -2, 1, 0, -1, -1, 0, 2, -2, 2, 1, -2, 2, -1, 0, -1, 0, 2, 0, 0, -1, -1, -1, -1, -1, 1, 1, -1, -1, 2, -1, 0, 0, 0, -1, 1, 0, 0, -1, -1, -1, 0, -1, -1, 1, -1, 1, 1, 2, 1, 0, -2, 0, -1, 1, 0, -2, 0, -1, 1, 1, -1, 0, 0, 3, -2, -1, 1, -1, 1, 4, -2, 1, 1, 0, 1, -1, 0, 2, 1, 0, 2, -1, -2, 0, 0, 0, 0, 0, -2, 1, -1, 2, 0, 0, 2, 1, 0, -1, 0, 2, 1, 0, 1, -2, 0, 0, 2, 0, 2, 2, -2, -3, 2, 2, -3, 3, 2, -2, 1, 1, -1, 0, -1, 1, -3, 2, -2, 0, -2, 0, -1, -3, 1, -3, 0, 0, -1, 1, 0, 0, 0, -3, 0, -1, 2, 0, -2, 0, 0, 1, 2, -1, -2, 4, 2, -1, -2, 0, -1, -1, 2, 2, 2, 1, 2, 1, -2, 1, 0, 0, 2, 1, 1, 2, 0, -3, 1, 2, 0, -1, -2, 0, 1, 1, 0, -1, 0, 1, -1, -3, -1, 0, 1, -2, -1, 1, -2, 1, 1, 2, 0, 0, -1, 3, 1, 0, 2, 1, -1, 1, -1, 1, 2, 0, 2, 1, 3, 2, 0, 1, 0, -1, 0, -1, -1, -1, 0, -1, 0, 2, 3, 1, 1, 1, 1, 1, 0, -1, 0, 2, 3, 0], [1, 0, 1, 0, -1, 1, 1, 0, -1, 0, 0, -1, -1, 1, 0, -2, 3, -1, 0, -1, 1, -2, 1, -1, 1, 1, 0, -1, 0, 2, 1, 2, -1, 0, 3, 0, 0, -2, 0, -1, -1, 1, -1, 1, -2, 2, -1, 1, -1, 1, 0, 1, 1, -1, 1, 1, 0, -1, -2, -1, 1, 0, -1, 0, 1, 2, -1, 0, -1, 0, -2, 0, 1, -1, 0, -2, 0, -2, -1, 2, 1, 0, 2, 2, -1, 0, 1, 1, -2, -1, -1, 0, 1, 0, 2, -1, -3, 3, 2, 2, -1, -2, 0, 0, 1, 3, -1, -2, 0, 1, -1, 1, 1, -1, 1, 0, 0, 2, 2, -1, 2, -1, -2, -1, -1, -1, 0, 0, -2, 0, 1, 1, 1, -2, 1, -2, 0, 0, -2, 0, -2, -2, -2, 1, 1, 0, 2, 1, 1, -1, 1, 0, 1, -1, 1, 0, 0, 0, 0, 0, 0, 1, 0, -1, 0, 1, 1, 0, -2, 2, 1, -1, 2, -1, 1, 0, 1, 0, 3, -1, 1, 0, 0, 1, 0, -2, 2, 0, 1, 1, 1, 0, 0, -1, 0, 1, 1, 3, 1, -2, 0, -1, 2, 0, 0, 1, -1, -1, 0, 0, 1, -2, -1, -1, 0, -1, -1, 0, 2, -1, 2, -2, -3, -3, 1, 1, -2, -1, -1, 0, -2, 0, -2, 0, 0, 1, 3, 0, 0, 0, 0, 2, 1, 0, 1, -4, -2, 0, -2, -1, 1, 1, -1, 0, 0, -3]]
        # e2 = [-2, 1, 2, -1, -1, 0, 0, 1, -3, 0, 0, 0, -2, -2, 0, 0, 0, 0, 1, 1, 1, 1, 2, 1, 1, -1, -1, 0, 1, 2, 0, -1, -1, 2, 0, 0, -2, 1, 1, 2, 0, 3, -1, 1, -2, -2, 0, -3, 0, 0, -1, -1, 0, 1, -3, -1, 1, 1, 1, -2, 0, -1, 1, -2, -2, -1, 2, 1, 1, -1, 0, 0, 1, -1, 2, -1, 1, -2, -1, 0, -2, 1, -1, -2, 0, 0, 1, 1, -1, -1, -1, -1, 0, 0, -1, 2, -1, 2, -2, -2, 1, -2, 2, -1, -1, 0, 0, 3, -1, 2, 2, -1, 2, 0, 2, 1, -1, -1, 0, 0, 1, 2, -1, -1, 3, 1, 0, 0, 1, -2, -1, 1, 2, 1, -1, -2, 1, 2, 0, 0, 0, 0, -1, 0, 1, 1, -1, 2, 2, 2, 0, 0, 1, -1, -3, 1, -2, 0, -1, -2, 1, 1, 1, 0, 1, -1, 1, -3, 0, -2, 0, 3, 3, -1, -3, 3, 0, -1, 2, 0, 1, 1, -1, 0, 1, -2, 1, -3, -1, 1, 1, 0, 1, -1, -4, 1, -4, 0, 0, 4, 0, -3, -2, -1, 0, -1, 3, 0, 1, -1, 0, -3, 2, -1, -1, 1, 1, -1, 1, -1, -1, 1, 1, 0, 1, 2, -1, 1, 1, 0, -1, 0, -2, 0, 0, -1, 1, -1, 0, 1, -1, -1, 2, -1, -2, -1, -2, -1, -3, -2, -1, 0, 0, 0, 0, 2]
        
        u = reduce_poly_vector(add_polynomial_vectors(multiply_matrix_poly_vector(A, r, Q_K, True), e1), Q_K)
        v = reduce_coefficients_mod_q(
            add_polynomials(
                (add_polynomials(multiply_poly_vectors(t, r, Q_K), e2)),
                m,
            ),
            Q_K,
        )
        
        return {"u": u, "v": v}

    def decapsulate_message(self, s: List[List[int]], uv: dict):
        # u = [decompress_poly_QK(polynomial) for polynomial in uv["u"]]
        # v = decompress_poly_QK(uv["v"])
        # s = [[-2, 0, 0, -1, 1, 2, 1, -1, -1, 2, 1, 1, -1, 1, 1, -2, -1, -1, -1, 1, -2, -1, 0, 0, 0, 1, -1, 0, 1, -1, 1, 0, 0, 2, 1, 0, -1, 1, -1, -1, -2, 0, 3, -1, -4, 1, -2, 1, -2, 2, -2, -1, 1, 1, 1, 0, 1, 2, -3, -1, 1, 0, -1, 0, 0, 0, 0, 1, 1, -2, 1, -1, 1, 0, -1, 2, 0, -1, 0, 1, 1, 2, -1, 1, -1, 0, -1, -2, 0, -2, -2, 1, 0, 1, 0, 2, 1, -2, 0, -1, 0, -1, -2, 1, -2, 0, -1, 1, -1, -1, 0, 1, 0, 0, 0, -3, 2, -1, -1, 0, 0, 0, -2, -1, 2, 0, 2, 3, 2, -1, 1, 0, 0, -1, 1, -1, 1, 1, -1, 0, 2, 1, -2, 2, -1, 1, -1, -1, -1, 1, 0, -1, -1, 2, -2, -2, -1, 2, 1, 1, 1, -2, 4, -3, 0, -1, 1, -2, -2, 1, 0, 1, -1, 0, -1, 0, 3, 0, 2, 1, 0, -1, 1, 1, -3, 2, 4, -2, -1, 0, 1, 2, -2, 0, 1, 0, 1, 2, 0, 2, 0, 2, 0, 1, -1, 2, -1, 0, 0, 0, 1, -1, 1, 1, 1, 1, 1, 2, 2, -1, -2, 1, 0, 0, 0, -2, 0, 0, 2, 1, -1, -2, 0, 0, -2, 0, 0, -1, -1, -1, 0, -2, 1, 0, 0, -3, 0, 2, -1, 1, -2, 0, 1, 0, -2, 0], [-1, 1, 1, 1, 0, 0, -1, -2, -1, -1, 0, 0, 1, 0, 1, 0, 0, 3, 0, -1, -1, -1, 0, -1, 3, 1, -1, 0, -1, 2, 2, 0, -1, -1, -1, 0, 2, -1, -1, -1, 0, -1, 0, 0, 0, 0, 0, 0, -1, 0, -1, 1, 0, 1, 0, -2, -2, 1, -2, 2, -2, 0, 1, 0, 0, 1, 0, 0, 0, 0, 2, -1, 1, -2, 0, 1, 0, 1, 2, 1, -3, -3, -1, -1, 2, 0, 2, -3, 1, -1, -1, 2, 0, -1, -1, 0, -2, 0, 1, 3, 2, -2, -2, 0, 0, 1, 1, 1, -2, 0, -3, 1, 1, -1, 2, 0, 2, -1, -1, 0, 2, -1, -1, 1, 2, 0, 2, 1, -1, -2, 0, -1, 1, 0, 0, 0, 0, 0, -1, -2, -1, -1, 2, 3, -3, 0, 1, -3, 1, 1, 2, -3, 1, 0, -2, -2, 0, 3, 0, -2, 0, 1, -1, 0, 0, -2, 0, -1, -1, -1, -3, 1, 1, -1, -2, 0, -1, -2, 0, -1, -2, 1, 0, 4, -2, 1, -1, -2, 1, -1, 0, 1, 1, 1, -2, 2, -1, 0, 0, -2, -1, -1, 0, 1, 2, 0, -2, 0, 0, -1, 0, -2, 1, 0, 0, -1, 3, -2, 1, 0, -1, 0, 2, -2, -1, 3, 2, 1, -1, 0, -2, -1, 0, 0, 0, 0, 0, 0, 2, 1, 2, 0, 0, 2, 1, 2, -1, 1, 0, 0, 1, 1, 0, 0, -1, 2], [0, 0, -2, -1, -2, 1, 0, 0, 1, 2, -2, 1, 0, -1, -1, 1, 1, 0, 2, -2, 2, 2, -1, 1, -3, -1, 3, 2, -1, 2, -3, -2, 0, 2, 2, -2, -1, 1, -1, 3, -1, -2, 0, 1, 0, 1, 1, -1, 3, 0, 0, -1, -1, 0, 1, 1, 1, 2, 1, 1, -1, 0, -3, -2, -2, 1, 0, 0, 2, 1, -2, -1, 2, -1, 0, -1, 2, 3, 1, 2, -1, -1, 2, 2, 0, 1, -1, 3, 0, 0, 1, 0, -1, 1, -1, 0, -2, -2, 1, -2, -2, 0, -2, -2, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, -2, -1, -2, 0, -2, 0, 0, 0, 0, 0, 3, 1, -1, 1, 1, -1, -1, -2, -1, -1, 2, -1, -1, 2, -1, 2, 3, 0, 1, 1, -2, 0, 0, 0, 2, 1, 0, 1, -2, -2, -2, 2, -1, 2, 1, -1, -2, 1, 0, 0, 1, 1, 1, -1, 1, 2, -4, -1, -1, 0, 0, 0, 1, 2, 0, -3, 0, 0, -1, 1, 0, 1, 0, 0, 2, -1, 0, 1, 1, 1, 2, 0, -3, 1, -1, -1, -1, 0, 0, 3, 0, 0, 1, 0, 0, -1, 1, -1, 1, 1, 4, -2, 2, 0, -2, 2, 1, 0, 0, -2, 1, 0, 0, 0, 1, -1, 2, 1, 1, 1, 0, -2, -1, 2, 1, 2, 1, -1, 0, -3, -1, 2, -1, 2, 1, 0, 0, 1, 3, 3, 0, -2]]

        mn = reduce_coefficients_mod_q(
            subtract_polynomials(uv["v"], multiply_poly_vectors(s, uv["u"], Q_K)), Q_K
        )
        # dp = [mod_plus(c, Q_K) for c in dp]

        import math
        return [math.ceil(Q_K / 2) if abs(m - math.ceil(Q_K / 2)) < min(abs(m), abs(m - Q_K)) else 0 for m in mn]
